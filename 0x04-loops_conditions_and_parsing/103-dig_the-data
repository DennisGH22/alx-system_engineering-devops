#!/usr/bin/env bash
# Path to the Apache log file
log_file="apache-access.log"

# Check if the log file exists
if [ ! -f "$log_file" ]; then
    echo "Error: $log_file does not exist."
    exit 1
fi

# Use awk to process the log file and replace âˆŸ with whitespace
awk '{ gsub(/\xE2\x88\x9F/, " "); print }' "$log_file" \
    | awk '{ip_code[$1, $9]++} END {for (entry in ip_code) printf "%4d %s\n", ip_code[entry], entry}' \
    | sort -rn
